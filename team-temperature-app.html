<!doctype html>
<html lang="no">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Team TemperaturmÃ¥ling</title>
    <style>
      :root {
        --primary-color: #3498db;
        --secondary-color: #2980b9;
        --background-color: #f5f7fa;
        --text-color: #333;
        --card-background: #fff;
        --border-color: #e1e8ed;
        --success-color: #2ecc71;
        --warning-color: #f39c12;
        --danger-color: #e74c3c;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--background-color);
        color: var(--text-color);
        margin: 0;
        padding: 20px;
        line-height: 1.6;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
      }

      h1,
      h2,
      h3 {
        color: var(--primary-color);
      }

      .card {
        background-color: var(--card-background);
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 20px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .question {
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 15px;
        margin-bottom: 15px;
      }

      .question-title {
        font-weight: 600;
        margin-bottom: 10px;
      }

      .section-title {
        background-color: var(--primary-color);
        color: white;
        padding: 10px;
        border-radius: 5px;
        margin-top: 20px;
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 12px 14px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        font-size: 16px;
        box-sizing: border-box;
        background-color: #fff;
        color: var(--text-color);
        transition:
          border-color 0.2s ease,
          box-shadow 0.2s ease,
          background-color 0.2s ease;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.18);
        background-color: #fdfefe;
      }

      input::placeholder,
      textarea::placeholder {
        color: #9aa5b1;
      }

      input:disabled,
      select:disabled,
      textarea:disabled {
        background-color: #f2f4f7;
        color: #9aa5b1;
        cursor: not-allowed;
      }

      input:invalid,
      select:invalid,
      textarea:invalid {
        border-color: var(--danger-color);
        box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.15);
      }

      textarea {
        min-height: 80px;
        resize: vertical;
      }

      button {
        background-color: var(--primary-color);
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
      }

      button:hover {
        background-color: var(--secondary-color);
      }

      .rating {
        display: flex;
        flex-direction: row-reverse;
        justify-content: flex-end;
      }

      .rating > input {
        display: none;
      }

      .rating > label {
        position: relative;
        width: 1.1em;
        font-size: 2.5em;
        color: #ddd;
        cursor: pointer;
      }

      .rating > label::before {
        content: 'â˜…';
        position: absolute;
        opacity: 0;
      }

      .rating > label:hover:before,
      .rating > label:hover ~ label:before {
        opacity: 1 !important;
      }

      .rating > input:checked ~ label:before {
        opacity: 1;
      }

      .rating > input:checked ~ label {
        color: #f0ad4e;
      }

      .rating-numbers {
        display: flex;
        justify-content: space-between;
        margin-top: 5px;
      }

      .rating-scale {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin: 10px 0;
      }

      .rating-scale input[type='radio'] {
        display: none;
      }

      .rating-scale label {
        display: inline-block;
        width: 50px;
        height: 50px;
        text-align: center;
        line-height: 50px;
        margin: 0 5px;
        background-color: #f1f1f1;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 24px;
      }

      .rating-scale input[type='radio']:checked + label {
        transform: scale(1.15);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        background-color: #3498db;
        color: white;
        border: 2px solid #2980b9;
        position: relative;
        z-index: 2;
      }

      .workload-scale {
        display: flex;
        justify-content: space-between;
      }

      .workload-scale label {
        flex: 1;
        text-align: center;
        padding: 15px 10px;
        border: 1px solid var(--border-color);
        margin: 0 5px;
        cursor: pointer;
        border-radius: 8px;
        transition: all 0.3s;
        font-size: 24px;
      }

      .workload-scale input[type='radio'] {
        display: none;
      }

      .workload-scale input[type='radio']:checked + label {
        transform: scale(1.05);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        border-color: var(--primary-color);
      }

      .yes-no-options {
        display: flex;
        gap: 20px;
        justify-content: center;
      }

      .yes-no-options label {
        display: inline-block;
        width: 50px;
        height: 50px;
        text-align: center;
        line-height: 50px;
        background-color: #f1f1f1;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 24px;
      }

      .yes-no-options input[type='radio'] {
        display: none;
      }

      .yes-no-options input[type='radio']:checked + label {
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        background-color: #3498db;
        color: white;
        border: 2px solid #2980b9;
        position: relative;
        z-index: 2;
      }

      .grid-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      @media (max-width: 768px) {
        .grid-container {
          grid-template-columns: 1fr;
        }
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
      }

      th {
        background-color: var(--primary-color);
        color: white;
      }

      tr:nth-child(even) {
        background-color: rgba(0, 0, 0, 0.03);
      }

      .chart-container {
        height: auto; /* Dynamisk hÃ¸yde */
        width: 100%; /* Full bredde */
        margin-top: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      canvas {
        max-width: 100%; /* SÃ¸rg for at canvas ikke overstiger foreldreelementet */
        height: auto; /* Dynamisk hÃ¸yde */
      }

      .progress {
        height: 20px;
        background-color: #f1f1f1;
        border-radius: 5px;
        margin-top: 5px;
        overflow: hidden;
      }

      .progress-bar {
        height: 100%;
        background-color: var(--primary-color);
        text-align: center;
        line-height: 20px;
        color: white;
        transition: width 0.5s;
      }

      .category-stats {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 15px;
        margin-top: 15px;
      }

      .stat-card {
        background-color: #f9f9f9;
        border-radius: 5px;
        padding: 10px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .stat-title {
        font-weight: 600;
        margin-bottom: 5px;
        font-size: 0.9em;
      }

      .tab-container {
        border-bottom: 1px solid var(--border-color);
        margin-bottom: 20px;
      }

      .tab-buttons {
        display: flex;
        overflow-x: auto;
      }

      .tab-button {
        padding: 10px 20px;
        background: none;
        border: none;
        cursor: pointer;
        font-weight: 600;
        color: var(--text-color);
        opacity: 0.7;
      }

      .tab-button.active {
        opacity: 1;
        border-bottom: 3px solid var(--primary-color);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .required-field::after {
        content: '*';
        color: var(--danger-color);
        margin-left: 4px;
      }

      .error-message {
        color: red;
        font-size: 12px;
        margin-top: 5px;
      }

      .confirmation-message {
        color: green;
        font-size: 14px;
        margin-bottom: 10px;
        text-align: center;
      }

      /* Legg til en pulserende animasjon pÃ¥ valgte emojier */
      @keyframes pulse-border {
        0% {
          box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.7);
        }
        70% {
          box-shadow: 0 0 0 6px rgba(52, 152, 219, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(52, 152, 219, 0);
        }
      }

      .rating-scale input[type='radio']:checked + label,
      .yes-no-options input[type='radio']:checked + label {
        animation: pulse-border 2s infinite;
      }

      /* Styling for ekspanderbare detaljer i tabellen */
      .details-row {
        display: none;
        background-color: #f8f9fa;
      }

      .details-row td {
        padding: 15px;
        border-top: none;
      }

      .details-content {
        padding: 10px;
        border-radius: 5px;
        border: 1px solid var(--border-color);
      }

      .details-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 10px;
        margin-bottom: 10px;
      }

      .details-item {
        display: flex;
        flex-direction: column;
      }

      .details-label {
        font-weight: 600;
        font-size: 0.9em;
        color: var(--primary-color);
      }

      .details-value {
        font-size: 1em;
      }

      .toggle-details-btn {
        background-color: transparent;
        color: var(--primary-color);
        border: 1px solid var(--primary-color);
        transition: all 0.2s;
      }

      .toggle-details-btn:hover {
        background-color: var(--primary-color);
        color: white;
      }

      .rating-scale input[type='radio']:checked + label,
      .yes-no-options input[type='radio']:checked + label {
        animation: pulse-border 2s infinite;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Team TemperaturmÃ¥ling</h1>

      <div id="main-content">
        <div class="tab-container">
          <div class="tab-buttons">
            <button class="tab-button active" data-tab="new-survey">
              Ny mÃ¥ling
            </button>
            <button class="tab-button" data-tab="stats">Statistikk</button>
            <button class="tab-button" data-tab="history">Historikk</button>
            <button class="tab-button" data-tab="settings">
              Innstillinger
            </button>
          </div>
        </div>

        <div class="tab-content active" id="new-survey">
          <div class="card">
            <h2>Registrer ny temperaturmÃ¥ling</h2>
            <form id="temperature-form">
              <div class="form-group">
                <label for="week-number" class="required-field"
                  >Ukenummer:</label
                >
                <div style="display: flex; align-items: center">
                  <input
                    type="number"
                    id="week-number"
                    min="1"
                    max="53"
                    required
                  />
                  <button
                    type="button"
                    id="refresh-week"
                    style="
                      margin-left: 10px;
                      background-color: #f1f1f1;
                      color: #333;
                      padding: 10px;
                      border: none;
                      border-radius: 4px;
                    "
                  >
                    <span style="font-size: 18px">ğŸ”„</span>
                  </button>
                </div>
                <div style="font-size: 12px; color: #666; margin-top: 5px">
                  Ukenummer settes automatisk basert pÃ¥ dagens dato
                </div>
              </div>

              <div class="form-group">
                <label for="name">Navn (valgfritt):</label>
                <input type="text" id="name" placeholder="Anonym hvis tomt" />
              </div>

              <!-- Trivsel og motivasjon -->
              <div class="section-title">Trivsel og motivasjon</div>

              <div class="question">
                <div class="question-title">
                  Hvordan har du hatt det pÃ¥ jobb denne uken?
                </div>
                <div class="rating-scale">
                  <input
                    type="radio"
                    name="feeling"
                    id="feeling-1"
                    value="1"
                    required
                  />
                  <label for="feeling-1">ğŸ˜</label>

                  <input type="radio" name="feeling" id="feeling-2" value="2" />
                  <label for="feeling-2">ğŸ˜•</label>

                  <input type="radio" name="feeling" id="feeling-3" value="3" />
                  <label for="feeling-3">ğŸ˜</label>

                  <input type="radio" name="feeling" id="feeling-4" value="4" />
                  <label for="feeling-4">ğŸ™‚</label>

                  <input type="radio" name="feeling" id="feeling-5" value="5" />
                  <label for="feeling-5">ğŸ˜„</label>
                </div>
                <div class="rating-numbers">
                  <span>DÃ¥rlig</span>
                  <span>Bra</span>
                </div>
              </div>

              <div class="question">
                <div class="question-title">
                  Hvor motivert har du fÃ¸lt deg denne uken?
                </div>
                <div class="rating-scale">
                  <input
                    type="radio"
                    name="motivation"
                    id="motivation-1"
                    value="1"
                    required
                  />
                  <label for="motivation-1">ğŸ¥±</label>

                  <input
                    type="radio"
                    name="motivation"
                    id="motivation-2"
                    value="2"
                  />
                  <label for="motivation-2">ğŸ˜’</label>

                  <input
                    type="radio"
                    name="motivation"
                    id="motivation-3"
                    value="3"
                  />
                  <label for="motivation-3">ğŸ˜</label>

                  <input
                    type="radio"
                    name="motivation"
                    id="motivation-4"
                    value="4"
                  />
                  <label for="motivation-4">ğŸ‘</label>

                  <input
                    type="radio"
                    name="motivation"
                    id="motivation-5"
                    value="5"
                  />
                  <label for="motivation-5">ğŸ”¥</label>
                </div>
                <div class="rating-numbers">
                  <span>Umotivert</span>
                  <span>SvÃ¦rt motivert</span>
                </div>
              </div>

              <!-- Arbeidsbelastning og stress -->
              <div class="section-title">Arbeidsbelastning og stress</div>

              <div class="question">
                <div class="question-title">
                  Hvordan har arbeidsmengden vÃ¦rt denne uken?
                </div>
                <div class="rating-scale">
                  <input
                    type="radio"
                    name="workload"
                    id="workload-1"
                    value="1"
                    required
                  />
                  <label for="workload-1">â˜•</label>

                  <input
                    type="radio"
                    name="workload"
                    id="workload-2"
                    value="2"
                  />
                  <label for="workload-2">ğŸ“‰</label>

                  <input
                    type="radio"
                    name="workload"
                    id="workload-3"
                    value="3"
                  />
                  <label for="workload-3">âš–ï¸</label>

                  <input
                    type="radio"
                    name="workload"
                    id="workload-4"
                    value="4"
                  />
                  <label for="workload-4">ğŸ“ˆ</label>

                  <input
                    type="radio"
                    name="workload"
                    id="workload-5"
                    value="5"
                  />
                  <label for="workload-5">ğŸ”¥</label>
                </div>
                <div class="rating-numbers">
                  <span>For lite</span>
                  <span>For mye</span>
                </div>
              </div>

              <div class="question">
                <div class="question-title">
                  Har du opplevd stress pÃ¥ grunn av arbeidet denne uken?
                </div>
                <div class="rating-scale">
                  <input
                    type="radio"
                    name="stress"
                    id="stress-1"
                    value="1"
                    required
                  />
                  <label for="stress-1">ğŸ˜Œ</label>

                  <input type="radio" name="stress" id="stress-2" value="2" />
                  <label for="stress-2">ğŸ™‚</label>

                  <input type="radio" name="stress" id="stress-3" value="3" />
                  <label for="stress-3">ğŸ˜</label>

                  <input type="radio" name="stress" id="stress-4" value="4" />
                  <label for="stress-4">ğŸ˜“</label>

                  <input type="radio" name="stress" id="stress-5" value="5" />
                  <label for="stress-5">ğŸ˜°</label>
                </div>
                <div class="rating-numbers">
                  <span>Ikke stresset</span>
                  <span>Veldig stresset</span>
                </div>
              </div>

              <!-- Klarhet og retning -->
              <div class="section-title">Klarhet og retning</div>

              <div class="question">
                <div class="question-title">
                  Har du hatt tydelige mÃ¥l og prioriteringer denne uken?
                </div>
                <div class="rating-scale">
                  <input
                    type="radio"
                    name="clarity"
                    id="clarity-1"
                    value="1"
                    required
                  />
                  <label for="clarity-1">ğŸŒ«ï¸</label>

                  <input type="radio" name="clarity" id="clarity-2" value="2" />
                  <label for="clarity-2">â“</label>

                  <input type="radio" name="clarity" id="clarity-3" value="3" />
                  <label for="clarity-3">ğŸ“‹</label>

                  <input type="radio" name="clarity" id="clarity-4" value="4" />
                  <label for="clarity-4">ğŸ“</label>

                  <input type="radio" name="clarity" id="clarity-5" value="5" />
                  <label for="clarity-5">ğŸ¯</label>
                </div>
                <div class="rating-numbers">
                  <span>Utydelig</span>
                  <span>SvÃ¦rt tydelig</span>
                </div>
              </div>

              <div class="question">
                <div class="question-title">
                  Er du trygg pÃ¥ hva som forventes av deg?
                </div>
                <div class="rating-scale">
                  <input
                    type="radio"
                    name="expectations"
                    id="expectations-1"
                    value="1"
                    required
                  />
                  <label for="expectations-1">ğŸ˜Ÿ</label>

                  <input
                    type="radio"
                    name="expectations"
                    id="expectations-2"
                    value="2"
                  />
                  <label for="expectations-2">ğŸ¤”</label>

                  <input
                    type="radio"
                    name="expectations"
                    id="expectations-3"
                    value="3"
                  />
                  <label for="expectations-3">ğŸ˜</label>

                  <input
                    type="radio"
                    name="expectations"
                    id="expectations-4"
                    value="4"
                  />
                  <label for="expectations-4">ğŸ‘</label>

                  <input
                    type="radio"
                    name="expectations"
                    id="expectations-5"
                    value="5"
                  />
                  <label for="expectations-5">ğŸ’¯</label>
                </div>
                <div class="rating-numbers">
                  <span>Utrygg</span>
                  <span>Veldig trygg</span>
                </div>
              </div>

              <!-- Samarbeid og kommunikasjon -->
              <div class="section-title">Samarbeid og kommunikasjon</div>

              <div class="question">
                <div class="question-title">
                  Hvordan har samarbeidet i teamet fungert denne uken?
                </div>
                <div class="rating-scale">
                  <input
                    type="radio"
                    name="collaboration"
                    id="collaboration-1"
                    value="1"
                    required
                  />
                  <label for="collaboration-1">ğŸï¸</label>

                  <input
                    type="radio"
                    name="collaboration"
                    id="collaboration-2"
                    value="2"
                  />
                  <label for="collaboration-2">ğŸ§©</label>

                  <input
                    type="radio"
                    name="collaboration"
                    id="collaboration-3"
                    value="3"
                  />
                  <label for="collaboration-3">ğŸ¤</label>

                  <input
                    type="radio"
                    name="collaboration"
                    id="collaboration-4"
                    value="4"
                  />
                  <label for="collaboration-4">ğŸ‘¥</label>

                  <input
                    type="radio"
                    name="collaboration"
                    id="collaboration-5"
                    value="5"
                  />
                  <label for="collaboration-5">ğŸš€</label>
                </div>
                <div class="rating-numbers">
                  <span>DÃ¥rlig</span>
                  <span>Utmerket</span>
                </div>
              </div>

              <div class="question">
                <div class="question-title">
                  Har kommunikasjonen i teamet vÃ¦rt god denne uken?
                </div>
                <div class="rating-scale">
                  <input
                    type="radio"
                    name="communication"
                    id="communication-1"
                    value="1"
                    required
                  />
                  <label for="communication-1">ğŸ”‡</label>

                  <input
                    type="radio"
                    name="communication"
                    id="communication-2"
                    value="2"
                  />
                  <label for="communication-2">ğŸ”ˆ</label>

                  <input
                    type="radio"
                    name="communication"
                    id="communication-3"
                    value="3"
                  />
                  <label for="communication-3">ğŸ”‰</label>

                  <input
                    type="radio"
                    name="communication"
                    id="communication-4"
                    value="4"
                  />
                  <label for="communication-4">ğŸ”Š</label>

                  <input
                    type="radio"
                    name="communication"
                    id="communication-5"
                    value="5"
                  />
                  <label for="communication-5">ğŸ“¢</label>
                </div>
                <div class="rating-numbers">
                  <span>DÃ¥rlig</span>
                  <span>Utmerket</span>
                </div>
              </div>

              <!-- Tilbakemelding og anerkjennelse -->
              <div class="section-title">Tilbakemelding og anerkjennelse</div>

              <div class="question">
                <div class="question-title">
                  Har du fÃ¥tt nok tilbakemelding pÃ¥ jobben din denne uken?
                </div>
                <div class="rating-scale">
                  <input
                    type="radio"
                    name="feedback"
                    id="feedback-1"
                    value="1"
                    required
                  />
                  <label for="feedback-1">ğŸ¦—</label>

                  <input
                    type="radio"
                    name="feedback"
                    id="feedback-2"
                    value="2"
                  />
                  <label for="feedback-2">ğŸ‘‚</label>

                  <input
                    type="radio"
                    name="feedback"
                    id="feedback-3"
                    value="3"
                  />
                  <label for="feedback-3">ğŸ’¬</label>

                  <input
                    type="radio"
                    name="feedback"
                    id="feedback-4"
                    value="4"
                  />
                  <label for="feedback-4">ğŸ‘</label>

                  <input
                    type="radio"
                    name="feedback"
                    id="feedback-5"
                    value="5"
                  />
                  <label for="feedback-5">ğŸ¯</label>
                </div>
                <div class="rating-numbers">
                  <span>For lite</span>
                  <span>Tilstrekkelig</span>
                </div>
              </div>

              <div class="question">
                <div class="question-title">
                  FÃ¸ler du deg anerkjent for innsatsen din?
                </div>
                <div class="rating-scale">
                  <input
                    type="radio"
                    name="recognition"
                    id="recognition-1"
                    value="1"
                    required
                  />
                  <label for="recognition-1">ğŸ˜”</label>

                  <input
                    type="radio"
                    name="recognition"
                    id="recognition-2"
                    value="2"
                  />
                  <label for="recognition-2">ğŸ¤·</label>

                  <input
                    type="radio"
                    name="recognition"
                    id="recognition-3"
                    value="3"
                  />
                  <label for="recognition-3">ğŸ‘Œ</label>

                  <input
                    type="radio"
                    name="recognition"
                    id="recognition-4"
                    value="4"
                  />
                  <label for="recognition-4">ğŸ‘</label>

                  <input
                    type="radio"
                    name="recognition"
                    id="recognition-5"
                    value="5"
                  />
                  <label for="recognition-5">ğŸ†</label>
                </div>
                <div class="rating-numbers">
                  <span>Ikke anerkjent</span>
                  <span>HÃ¸yt verdsatt</span>
                </div>
              </div>

              <!-- Forbedringer og lÃ¦ring -->
              <div class="section-title">Forbedringer og lÃ¦ring</div>

              <div class="question">
                <div class="question-title">
                  Har du fÃ¥tt mulighet til Ã¥ lÃ¦re noe nytt denne uken?
                </div>
                <div class="yes-no-options">
                  <input
                    type="radio"
                    name="learning"
                    id="learning-yes"
                    value="ja"
                    required
                  />
                  <label for="learning-yes">ğŸ§ </label>

                  <input
                    type="radio"
                    name="learning"
                    id="learning-no"
                    value="nei"
                  />
                  <label for="learning-no">ğŸ¤·</label>
                </div>
                <div class="rating-numbers">
                  <span>Ja, har lÃ¦rt noe nytt</span>
                  <span>Nei, ingen nye lÃ¦ringspunkter</span>
                </div>
              </div>

              <div class="question">
                <div class="question-title">
                  Har du opplevd hindringer som kunne vÃ¦rt unngÃ¥tt denne uken?
                </div>
                <div class="yes-no-options">
                  <input
                    type="radio"
                    name="obstacles"
                    id="obstacles-yes"
                    value="ja"
                    required
                  />
                  <label for="obstacles-yes">ğŸš§</label>

                  <input
                    type="radio"
                    name="obstacles"
                    id="obstacles-no"
                    value="nei"
                  />
                  <label for="obstacles-no">ğŸ›£ï¸</label>
                </div>
                <div class="rating-numbers">
                  <span>Ja, opplevde hindringer</span>
                  <span>Nei, ingen unÃ¸dvendige hindringer</span>
                </div>
                <div
                  class="form-group"
                  id="obstacles-comment-container"
                  style="display: none; margin-top: 10px"
                >
                  <label for="obstacles-comment"
                    >Kan du beskrive hindringene?</label
                  >
                  <textarea
                    id="obstacles-comment"
                    placeholder="Beskriv hindringene her"
                  ></textarea>
                </div>
              </div>

              <div class="form-group">
                <label for="general-comment"
                  ><strong>Andre kommentarer (valgfritt):</strong></label
                >
                <textarea
                  id="general-comment"
                  placeholder="Skriv eventuelle kommentarer her"
                ></textarea>
              </div>

              <button type="submit">Lagre mÃ¥ling</button>
            </form>
          </div>
        </div>

        <div class="tab-content" id="stats">
          <div class="grid-container">
            <div class="card">
              <h2>Team helse-indeks</h2>
              <div id="team-health-index"></div>
            </div>

            <div class="card">
              <h2>Svar denne uken</h2>
              <div id="current-week-stats"></div>
            </div>

            <div class="card">
              <h2>Kategori-statistikk</h2>
              <div class="category-stats" id="category-stats"></div>
            </div>

            <div class="card">
              <h2>Trend over tid</h2>
              <div class="chart-container">
                <canvas id="trend-chart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <div class="tab-content" id="history">
          <div class="card">
            <h2>Historiske mÃ¥linger</h2>
            <table id="measurements-table">
              <thead>
                <tr>
                  <th>Uke</th>
                  <th>Navn</th>
                  <th>Dato</th>
                  <th>Team helse-indeks</th>
                  <th>Detaljer</th>
                </tr>
              </thead>
              <tbody>
                <!-- Data will be inserted here -->
              </tbody>
            </table>
          </div>
        </div>

        <div class="tab-content" id="settings">
          <div class="card">
            <h2>TeamstÃ¸rrelse</h2>
            <div class="form-group">
              <label for="team-size">Antall teammedlemmer:</label>
              <input type="number" id="team-size" min="1" />
              <button id="save-team-size">Lagre</button>
            </div>
          </div>

          <div class="card">
            <h2>DatahÃ¥ndtering</h2>
            <button id="export-btn">Eksporter data (JSON)</button>
            <button
              id="save-to-file-btn"
              style="background-color: #27ae60; margin-left: 10px"
            >
              Lagre til fil
            </button>
            <button
              id="clear-btn"
              style="background-color: #e74c3c; margin-left: 10px"
            >
              Slett alle data
            </button>
            <div
              style="
                margin-top: 15px;
                padding: 10px;
                background-color: #f8f9fa;
                border-radius: 5px;
              "
            >
              <p><strong>Slik bruker du permanent lagring:</strong></p>
              <ol>
                <li>
                  Klikk pÃ¥ "Lagre til fil" for Ã¥ laste ned team-temperature.json
                </li>
                <li>
                  Plasser filen i samme mappe som team-temperature-app.html
                </li>
                <li>
                  Appen vil automatisk laste data fra denne filen ved oppstart
                </li>
                <li>Husk Ã¥ lagre nye data til filen etter hver Ã¸kt</li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
      // DOM Elements
      const temperatureForm = document.getElementById('temperature-form')
      const weekNumberInput = document.getElementById('week-number')
      const refreshWeekBtn = document.getElementById('refresh-week')
      const nameInput = document.getElementById('name')
      const obstaclesRadioYes = document.getElementById('obstacles-yes')
      const obstaclesRadioNo = document.getElementById('obstacles-no')
      const obstaclesCommentContainer = document.getElementById(
        'obstacles-comment-container'
      )
      const obstaclesComment = document.getElementById('obstacles-comment')
      const generalComment = document.getElementById('general-comment')
      const exportBtn = document.getElementById('export-btn')
      const clearBtn = document.getElementById('clear-btn')
      const measurementsTable = document
        .getElementById('measurements-table')
        .querySelector('tbody')
      const teamHealthIndex = document.getElementById('team-health-index')
      const currentWeekStats = document.getElementById('current-week-stats')
      const categoryStats = document.getElementById('category-stats')
      const teamSizeInput = document.getElementById('team-size')
      const saveTeamSizeBtn = document.getElementById('save-team-size')
      const saveToFileBtn = document.getElementById('save-to-file-btn')
      const mainContent = document.getElementById('main-content')

      // Applikasjonsdata
      let appData = {
        teamSize: 9,
        temperatureData: [],
        exportDate: null,
      }

      // Chart elements
      let trendChart

      // Tab functionality
      const tabButtons = document.querySelectorAll('.tab-button')
      const tabContents = document.querySelectorAll('.tab-content')

      tabButtons.forEach((button) => {
        button.addEventListener('click', () => {
          // Remove active class from all buttons and tabs
          tabButtons.forEach((btn) => btn.classList.remove('active'))
          tabContents.forEach((content) => content.classList.remove('active'))

          // Add active class to clicked button and corresponding tab
          button.classList.add('active')
          const tabId = button.getAttribute('data-tab')
          document.getElementById(tabId).classList.add('active')

          // Update charts if needed
          if (tabId === 'stats') {
            initCharts()
            updateCharts()
          }
        })
      })

      // Show obstacles comment field when "Yes" is selected
      obstaclesRadioYes.addEventListener('change', function () {
        obstaclesCommentContainer.style.display = 'block'
      })

      obstaclesRadioNo.addEventListener('change', function () {
        obstaclesCommentContainer.style.display = 'none'
        obstaclesComment.value = ''
      })

      // Initialize the app
      function initApp() {
        // Last data fra server API
        loadDataFromApi()

        // Set default week number to current week
        setCurrentWeek()

        // Refresh week button
        refreshWeekBtn.addEventListener('click', setCurrentWeek)

        // Show obstacles comment field when "Yes" is selected
        obstaclesRadioYes.addEventListener('change', function () {
          obstaclesCommentContainer.style.display = 'block'
        })

        obstaclesRadioNo.addEventListener('change', function () {
          obstaclesCommentContainer.style.display = 'none'
          obstaclesComment.value = ''
        })

        // Form submission
        temperatureForm.addEventListener('submit', function (e) {
          e.preventDefault() // Hindrer standard form-submission
          saveTemperature() // Kaller funksjonen for Ã¥ lagre data
        })

        // Export data
        exportBtn.addEventListener('click', exportData)

        // Clear data
        clearBtn.addEventListener('click', clearData)

        // Legg til event listener for Ã¥ lagre teamstÃ¸rrelsen
        saveTeamSizeBtn.addEventListener('click', updateTeamSize)
        saveToFileBtn.addEventListener('click', saveDataToFile)
      }

      // Last data fra PHP API
      async function loadDataFromApi() {
        try {
          const response = await fetch('team-temperature-api.php', {
            method: 'GET',
          })

          if (response.ok) {
            const result = await response.json()

            if (result.status === 200) {
              // Sett appData fra API-respons
              appData = result.data

              // Oppdater UI
              updateUIWithData()
              console.log('Data lastet fra API')
            } else {
              console.log('Kunne ikke laste data fra API:', result.message)
            }
          } else {
            console.log(
              'Feil ved lasting av data fra API:',
              response.statusText
            )
          }
        } catch (error) {
          console.log('Feil ved kommunikasjon med API:', error)
        }
      }

      // Oppdaterer UI basert pÃ¥ data
      function updateUIWithData() {
        // Sett teamstÃ¸rrelse
        teamSizeInput.value = appData.teamSize || 9

        // Oppdater statistikk og historikk
        updateTeamHealthIndex()
        updateCurrentWeekStats()
        updateCategoryStats()
        updateHistoryTable()

        // Oppdater grafer hvis statistikk-fanen er aktiv
        if (document.getElementById('stats').classList.contains('active')) {
          initCharts()
          updateCharts()
        }
      }

      // Set current week number
      function setCurrentWeek() {
        const currentDate = new Date()
        const startDate = new Date(currentDate.getFullYear(), 0, 1)
        const days = Math.floor(
          (currentDate - startDate) / (24 * 60 * 60 * 1000)
        )
        const weekNumber = Math.ceil((days + startDate.getDay() + 1) / 7)
        weekNumberInput.value = weekNumber
        updateCurrentWeekStats() // Oppdater statistikken for gjeldende uke
      }

      // Save temperature measurement
      async function saveTemperature() {
        const requiredFields = document.querySelectorAll('input[required]')
        let isValid = true

        // Fjern tidligere feilmeldinger
        document.querySelectorAll('.error-message').forEach((el) => el.remove())

        // Valider alle obligatoriske felt
        requiredFields.forEach((field) => {
          // Finn nÃ¦rmeste .question-wrapper. Hvis den ikke finnes, opprett en.
          let parent = field.closest('.question')
          if (!parent) {
            parent = document.createElement('div')
            parent.className = 'question'
            // Flytt feltet inn i den nye wrapperen.
            field.parentNode.insertBefore(parent, field)
            parent.appendChild(field)
          }

          // Hvis feltet er en radioknapp: sjekk om noen i gruppen er valgt.
          // For andre typer kan du sjekke field.value.
          if (field.type === 'radio') {
            const radios = document.getElementsByName(field.name)
            let isChecked = false
            for (let i = 0; i < radios.length; i++) {
              if (radios[i].checked) {
                isChecked = true
                break
              }
            }
            if (!isChecked) {
              isValid = false
              if (!parent.querySelector('.error-message')) {
                const errorMessage = document.createElement('div')
                errorMessage.className = 'error-message'
                errorMessage.textContent = 'Dette spÃ¸rsmÃ¥let mÃ¥ besvares.'
                parent.appendChild(errorMessage)
              }
            }
          } else {
            if (!field.value) {
              isValid = false
              if (!parent.querySelector('.error-message')) {
                const errorMessage = document.createElement('div')
                errorMessage.className = 'error-message'
                errorMessage.textContent = 'Dette feltet mÃ¥ fylles ut.'
                parent.appendChild(errorMessage)
              }
            }
          }
        })

        // Hvis skjemaet ikke er gyldig, stopp prosessen
        if (!isValid) {
          return
        }

        // Samle inn data fra skjemaet
        const weekNumber = parseInt(weekNumberInput.value)
        const name = nameInput.value || 'Anonym'
        const date = new Date().toISOString().split('T')[0]

        const measurement = {
          week: weekNumber,
          name: name,
          date: date,
          feeling: getRadioValue('feeling'),
          motivation: getRadioValue('motivation'),
          workload: getRadioValue('workload'),
          stress: getRadioValue('stress'),
          clarity: getRadioValue('clarity'),
          expectations: getRadioValue('expectations'),
          collaboration: getRadioValue('collaboration'),
          communication: getRadioValue('communication'),
          feedback: getRadioValue('feedback'),
          recognition: getRadioValue('recognition'),
          learning: getRadioValue('learning'),
          obstacles: getRadioValue('obstacles'),
          obstaclesComment: obstaclesRadioYes.checked
            ? obstaclesComment.value
            : '',
          generalComment: generalComment.value,
        }

        try {
          // Lagre mÃ¥linger via API
          const response = await fetch('team-temperature-api.php', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              action: 'add_measurement',
              measurement: measurement,
            }),
          })

          const result = await response.json()

          if (result.status === 200) {
            // Oppdater appData med data fra API
            appData = result.data

            // Tilbakestill skjemaet
            temperatureForm.reset()
            obstaclesCommentContainer.style.display = 'none'

            // Oppdater UI
            updateUIWithData()

            // Vis bekreftelsesmelding
            showConfirmationMessage('MÃ¥lingen er lagret pÃ¥ serveren!')
          } else {
            showConfirmationMessage(
              'Kunne ikke lagre mÃ¥ling: ' + result.message,
              'error'
            )
          }
        } catch (error) {
          console.error('Feil ved lagring av mÃ¥ling:', error)
          showConfirmationMessage(
            'Feil ved lagring av mÃ¥ling. Sjekk nettverkstilkoblingen.',
            'error'
          )
        }
      }

      // Get value of selected radio button
      function getRadioValue(name) {
        const radios = document.getElementsByName(name)
        for (let i = 0; i < radios.length; i++) {
          if (radios[i].checked) {
            return radios[i].value
          }
        }
        return null
      }

      // Oppdaterer historikktabellen
      function updateHistoryTable() {
        if (!appData.temperatureData) return

        // Sorter data fra nyeste til eldste
        const sortedData = [...appData.temperatureData].sort((a, b) => {
          // Sorter primÃ¦rt pÃ¥ uke (synkende)
          if (b.week !== a.week) return b.week - a.week
          // Sorter deretter pÃ¥ dato (synkende)
          return new Date(b.date) - new Date(a.date)
        })

        measurementsTable.innerHTML = sortedData
          .map(
            (entry) => `
        <tr data-week="${entry.week}" data-name="${entry.name}" data-date="${entry.date}">
          <td>${entry.week}</td>
          <td>${entry.name}</td>
          <td>${entry.date}</td>
          <td>${calculateAverageHealth([entry])}</td>
          <td><button class="toggle-details-btn" onclick="viewDetails(${entry.week}, '${entry.name}', '${entry.date}')">Vis detaljer</button></td>
        </tr>
      `
          )
          .join('')
      }

      // Export data to JSON
      async function exportData() {
        try {
          // Hent oppdatert data fra API-et fÃ¸rst
          const response = await fetch('team-temperature-api.php', {
            method: 'GET',
          })

          if (response.ok) {
            const result = await response.json()

            if (result.status === 200) {
              // Eksporter dataene som en nedlastbar fil
              const json = JSON.stringify(result.data, null, 2)
              const blob = new Blob([json], { type: 'application/json' })
              const url = URL.createObjectURL(blob)
              const a = document.createElement('a')
              a.href = url
              a.download = 'team-temperature-export.json'
              a.click()
              URL.revokeObjectURL(url)

              showConfirmationMessage('Data er eksportert!')
            } else {
              showConfirmationMessage(
                'Kunne ikke hente data for eksport: ' + result.message,
                'error'
              )
            }
          } else {
            showConfirmationMessage(
              'Feil ved kommunikasjon med API: ' + response.statusText,
              'error'
            )
          }
        } catch (error) {
          console.error('Feil ved eksport av data:', error)
          showConfirmationMessage(
            'Feil ved eksport av data. Sjekk nettverkstilkoblingen.',
            'error'
          )
        }
      }

      // Clear all data
      async function clearData() {
        if (
          confirm(
            'Er du sikker pÃ¥ at du vil slette alle data? Dette vil slette alle mÃ¥linger permanent fra serveren.'
          )
        ) {
          try {
            // Kall PHP API for Ã¥ slette data pÃ¥ serveren
            const response = await fetch('team-temperature-api.php', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                action: 'clear_all_data',
              }),
            })

            const result = await response.json()

            if (result.status === 200) {
              // Oppdater appData med den tomme datastrukturen fra API
              appData = result.data

              // Oppdater UI
              updateUIWithData()

              // Tilbakestill eventuelle data i form
              temperatureForm.reset()
              obstaclesCommentContainer.style.display = 'none'

              // Vis bekreftelsesmelding
              showConfirmationMessage('Alle mÃ¥ledata er slettet fra serveren!')
            } else {
              showConfirmationMessage(
                'Kunne ikke slette data: ' + result.message,
                'error'
              )
            }
          } catch (error) {
            console.error('Feil ved sletting av data:', error)
            showConfirmationMessage(
              'Feil ved sletting av data. Sjekk nettverkstilkoblingen.',
              'error'
            )
          }
        }
      }

      // View details of a measurement
      function viewDetails(week, name, date) {
        if (!appData.temperatureData) return

        const entry = appData.temperatureData.find(
          (e) => e.week === week && e.name === name && e.date === date
        )

        if (!entry) return

        // Finn target row basert pÃ¥ attributter
        const targetRow = document.querySelector(
          `tr[data-week="${week}"][data-name="${name}"][data-date="${date}"]`
        )

        if (!targetRow) return

        // Sjekk om detaljraden allerede eksisterer
        let detailsRow = targetRow.nextElementSibling
        const isDetailsRowVisible =
          detailsRow && detailsRow.classList.contains('details-row')

        // Oppdater knapp-tekst for alle andre rader
        document.querySelectorAll('.toggle-details-btn').forEach((btn) => {
          btn.textContent = 'Vis detaljer'
        })

        // Hvis detaljraden allerede er synlig, fjern den
        if (isDetailsRowVisible) {
          detailsRow.remove()
          return
        }

        // Skjul alle andre detaljrader fÃ¸rst
        document.querySelectorAll('.details-row').forEach((row) => row.remove())

        // Opprett detaljraden
        detailsRow = document.createElement('tr')
        detailsRow.className = 'details-row'
        detailsRow.style.display = 'table-row' // Vis den med en gang

        // Opprett en celle som spenner over hele bredden
        const detailsCell = document.createElement('td')
        detailsCell.colSpan = 5 // Antall kolonner i tabellen

        // Opprett detaljinnholdet med alle mÃ¥lingene
        const detailsContent = document.createElement('div')
        detailsContent.className = 'details-content'

        // Opprett rutenett-layout for detaljer
        const detailsGrid = document.createElement('div')
        detailsGrid.className = 'details-grid'

        // Samle vurderinger i en gruppe
        const scoreDetails = [
          {
            label: 'Trivsel',
            value: entry.feeling,
            emoji: getEmojiBySentiment(entry.feeling, 'feeling'),
          },
          {
            label: 'Motivasjon',
            value: entry.motivation,
            emoji: getEmojiBySentiment(entry.motivation, 'motivation'),
          },
          {
            label: 'Arbeidsmengde',
            value: entry.workload,
            emoji: getEmojiBySentiment(entry.workload, 'workload'),
          },
          {
            label: 'Stress',
            value: entry.stress,
            emoji: getEmojiBySentiment(entry.stress, 'stress'),
          },
          {
            label: 'Klarhet',
            value: entry.clarity,
            emoji: getEmojiBySentiment(entry.clarity, 'clarity'),
          },
          {
            label: 'Forventninger',
            value: entry.expectations,
            emoji: getEmojiBySentiment(entry.expectations, 'expectations'),
          },
          {
            label: 'Samarbeid',
            value: entry.collaboration,
            emoji: getEmojiBySentiment(entry.collaboration, 'collaboration'),
          },
          {
            label: 'Kommunikasjon',
            value: entry.communication,
            emoji: getEmojiBySentiment(entry.communication, 'communication'),
          },
          {
            label: 'Tilbakemelding',
            value: entry.feedback,
            emoji: getEmojiBySentiment(entry.feedback, 'feedback'),
          },
          {
            label: 'Anerkjennelse',
            value: entry.recognition,
            emoji: getEmojiBySentiment(entry.recognition, 'recognition'),
          },
        ]

        // Legg til alle skÃ¥rdetaljer
        scoreDetails.forEach((item) => {
          const detailItem = document.createElement('div')
          detailItem.className = 'details-item'

          const label = document.createElement('div')
          label.className = 'details-label'
          label.textContent = item.label

          const value = document.createElement('div')
          value.className = 'details-value'
          value.textContent = `${item.emoji} ${item.value}/5`

          detailItem.appendChild(label)
          detailItem.appendChild(value)
          detailsGrid.appendChild(detailItem)
        })

        // Legg til lÃ¦ring og hindringer
        const learningItem = document.createElement('div')
        learningItem.className = 'details-item'

        const learningLabel = document.createElement('div')
        learningLabel.className = 'details-label'
        learningLabel.textContent = 'LÃ¦rt noe nytt'

        const learningValue = document.createElement('div')
        learningValue.className = 'details-value'
        learningValue.textContent = `${entry.learning === 'ja' ? 'ğŸ§ ' : 'ğŸ¤·'} ${entry.learning}`

        learningItem.appendChild(learningLabel)
        learningItem.appendChild(learningValue)
        detailsGrid.appendChild(learningItem)

        const obstaclesItem = document.createElement('div')
        obstaclesItem.className = 'details-item'

        const obstaclesLabel = document.createElement('div')
        obstaclesLabel.className = 'details-label'
        obstaclesLabel.textContent = 'Opplevd hindringer'

        const obstaclesValue = document.createElement('div')
        obstaclesValue.className = 'details-value'
        obstaclesValue.textContent = `${entry.obstacles === 'ja' ? 'ğŸš§' : 'ğŸ›£ï¸'} ${entry.obstacles}`

        obstaclesItem.appendChild(obstaclesLabel)
        obstaclesItem.appendChild(obstaclesValue)
        detailsGrid.appendChild(obstaclesItem)

        // Legg til kommentarer hvis de finnes
        let commentSection = ''

        if (entry.obstaclesComment && entry.obstacles === 'ja') {
          commentSection += `
          <div style="margin-top: 15px;">
            <div class="details-label">Hindringer kommentar:</div>
            <div class="details-value" style="font-style: italic;">"${entry.obstaclesComment}"</div>
          </div>
        `
        }

        if (entry.generalComment) {
          commentSection += `
          <div style="margin-top: 15px;">
            <div class="details-label">Generell kommentar:</div>
            <div class="details-value" style="font-style: italic;">"${entry.generalComment}"</div>
          </div>
        `
        }

        // Sett sammen innholdet
        detailsContent.innerHTML = `
        ${detailsGrid.outerHTML}
        ${commentSection}
      `

        detailsCell.appendChild(detailsContent)
        detailsRow.appendChild(detailsCell)

        // Sett inn detaljraden etter mÃ¥lingsraden
        targetRow.parentNode.insertBefore(detailsRow, targetRow.nextSibling)

        // Oppdater "Vis detaljer"-knappen
        const detailsButton = targetRow.querySelector('button')
        if (detailsButton) {
          detailsButton.textContent = 'Skjul detaljer'
        }
      }

      // Hjelpefunksjon for Ã¥ fÃ¥ emoji basert pÃ¥ skÃ¥r og type
      function getEmojiBySentiment(score, type) {
        const score_n = parseInt(score)

        const emojis = {
          feeling: ['ğŸ˜', 'ğŸ˜•', 'ğŸ˜', 'ğŸ™‚', 'ğŸ˜„'],
          motivation: ['ğŸ¥±', 'ğŸ˜’', 'ğŸ˜', 'ğŸ‘', 'ğŸ”¥'],
          workload: ['â˜•', 'ğŸ“‰', 'âš–ï¸', 'ğŸ“ˆ', 'ğŸ”¥'],
          stress: ['ğŸ˜Œ', 'ğŸ™‚', 'ğŸ˜', 'ğŸ˜“', 'ğŸ˜°'],
          clarity: ['ğŸŒ«ï¸', 'â“', 'ğŸ“‹', 'ğŸ“', 'ğŸ¯'],
          expectations: ['ğŸ˜Ÿ', 'ğŸ¤”', 'ğŸ˜', 'ğŸ‘', 'ğŸ’¯'],
          collaboration: ['ğŸï¸', 'ğŸ§©', 'ğŸ¤', 'ğŸ‘¥', 'ğŸš€'],
          communication: ['ğŸ”‡', 'ğŸ”ˆ', 'ğŸ”‰', 'ğŸ”Š', 'ğŸ“¢'],
          feedback: ['ğŸ¦—', 'ğŸ‘‚', 'ğŸ’¬', 'ğŸ‘', 'ğŸ¯'],
          recognition: ['ğŸ˜”', 'ğŸ¤·', 'ğŸ‘Œ', 'ğŸ‘', 'ğŸ†'],
        }

        // Juster score til Ã¥ vÃ¦re 0-basert for array indeksering
        return emojis[type][score_n - 1] || 'â“'
      }

      // Calculate average health score
      function calculateAverageHealth(data) {
        if (!data || data.length === 0) return 0
        const total = data.reduce((sum, entry) => {
          return (
            sum +
            (parseInt(entry.feeling) +
              parseInt(entry.motivation) +
              parseInt(entry.workload) +
              parseInt(entry.stress) +
              parseInt(entry.clarity) +
              parseInt(entry.expectations) +
              parseInt(entry.collaboration) +
              parseInt(entry.communication) +
              parseInt(entry.feedback) +
              parseInt(entry.recognition)) /
              10
          )
        }, 0)
        return (total / data.length).toFixed(2)
      }

      // Oppdaterer teamstÃ¸rrelse
      async function updateTeamSize() {
        const newTeamSize = teamSizeInput.value

        if (!newTeamSize || newTeamSize < 1) {
          showConfirmationMessage(
            'Ugyldig teamstÃ¸rrelse. Angi et positivt heltall.',
            'error'
          )
          return
        }

        try {
          // Kall API for Ã¥ oppdatere teamstÃ¸rrelse
          const response = await fetch('team-temperature-api.php', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              action: 'update_team_size',
              teamSize: newTeamSize,
            }),
          })

          const result = await response.json()

          if (result.status === 200) {
            // Oppdater appData med data fra API
            appData = result.data

            // Oppdater UI
            updateTeamHealthIndex()

            showConfirmationMessage('TeamstÃ¸rrelse er oppdatert!')
          } else {
            showConfirmationMessage(
              'Kunne ikke oppdatere teamstÃ¸rrelse: ' + result.message,
              'error'
            )
          }
        } catch (error) {
          console.error('Feil ved oppdatering av teamstÃ¸rrelse:', error)
          showConfirmationMessage(
            'Feil ved oppdatering av teamstÃ¸rrelse. Sjekk nettverkstilkoblingen.',
            'error'
          )
        }
      }

      // Lagre data til fil via API
      async function saveDataToFile() {
        try {
          // FÃ¸rst, hent oppdatert data fra server (i tilfelle andre har gjort endringer)
          await loadDataFromApi()

          // NÃ¥ har vi oppdatert appData, vis en bekreftelsesmelding
          showConfirmationMessage('Data er lagret og oppdatert pÃ¥ serveren!')
        } catch (error) {
          console.error('Feil ved lagring til fil:', error)
          showConfirmationMessage(
            'Feil ved lagring til fil. Sjekk nettverkstilkoblingen.',
            'error'
          )
        }
      }

      // Vis bekreftelsesmelding
      function showConfirmationMessage(message, type = 'success') {
        const confirmationMessage = document.createElement('div')
        confirmationMessage.className = 'confirmation-message'
        confirmationMessage.style.color = type === 'success' ? 'green' : 'red'
        confirmationMessage.style.fontSize = '14px'
        confirmationMessage.style.marginTop = '10px'
        confirmationMessage.textContent = message

        // Legg til meldingen Ã¸verst i skjemaet
        temperatureForm.prepend(confirmationMessage)

        // Fjern meldingen etter 3 sekunder
        setTimeout(() => {
          confirmationMessage.remove()
        }, 3000)
      }

      // Oppdatere teamhelse-indeks visningen
      function updateTeamHealthIndex() {
        if (!appData.temperatureData || appData.temperatureData.length === 0) {
          teamHealthIndex.innerHTML = `<p>Ingen data tilgjengelig</p>`
          return
        }

        // Hent unike uker
        const weeks = [
          ...new Set(appData.temperatureData.map((entry) => entry.week)),
        ].sort((a, b) => b - a)
        const currentWeek = weeks[0]
        const currentWeekData = appData.temperatureData.filter(
          (entry) => entry.week === currentWeek
        )
        const responseCount = currentWeekData.length
        const responseRate = (responseCount / appData.teamSize) * 100

        // Beregn rÃ¥skÃ¥r
        const rawScore = calculateAverageHealth(currentWeekData)

        // Beregn Bayesiansk justert indeks
        const bayesianIndex = calculateBayesianAdjustedIndex(
          rawScore,
          responseCount,
          appData.teamSize
        )

        // Hent tidligere ukers indekser
        const previousWeekIndex =
          weeks.length > 1
            ? calculateBayesianAdjustedIndex(
                calculateAverageHealth(
                  appData.temperatureData.filter(
                    (entry) => entry.week === weeks[1]
                  )
                ),
                appData.temperatureData.filter(
                  (entry) => entry.week === weeks[1]
                ).length,
                appData.teamSize
              )
            : null

        const twoWeeksAgoIndex =
          weeks.length > 2
            ? calculateBayesianAdjustedIndex(
                calculateAverageHealth(
                  appData.temperatureData.filter(
                    (entry) => entry.week === weeks[2]
                  )
                ),
                appData.temperatureData.filter(
                  (entry) => entry.week === weeks[2]
                ).length,
                appData.teamSize
              )
            : null

        // Beregn bevegelig gjennomsnitt
        const finalIndex = calculateMovingAverage(
          bayesianIndex,
          previousWeekIndex,
          twoWeeksAgoIndex
        )

        // Bestem fargen pÃ¥ konfidensindikator
        let confidenceColor
        if (responseRate >= 75) {
          confidenceColor = '#2ecc71' // HÃ¸y konfidens - grÃ¸nn
        } else if (responseRate >= 50) {
          confidenceColor = '#f39c12' // Middels konfidens - oransje
        } else {
          confidenceColor = '#e74c3c' // Lav konfidens - rÃ¸d
        }

        // Vis indeksen med konfidensindikator
        teamHealthIndex.innerHTML = `
        <div style="font-size: 24px; margin-bottom: 10px;">
          <span style="font-weight: bold;">${finalIndex.toFixed(2)}</span>
          <span style="font-size: 14px; color: ${confidenceColor};">
            (${responseRate.toFixed(0)}% svarprosent)
          </span>
        </div>
        <div style="font-size: 14px; color: #666;">
          RÃ¥skÃ¥r: ${rawScore} | Bayesiansk justert: ${bayesianIndex.toFixed(2)}
        </div>
        <div style="height: 10px; background-color: #f1f1f1; border-radius: 5px; margin-top: 10px;">
          <div style="height: 100%; width: ${(finalIndex / 5) * 100}%; background-color: ${confidenceColor}; border-radius: 5px;"></div>
        </div>
      `
      }

      // Oppdater statistikk for gjeldende uke
      function updateCurrentWeekStats() {
        if (!appData.temperatureData || appData.temperatureData.length === 0) {
          currentWeekStats.innerHTML = `
          <p>Antall svar: 0</p>
          <p>Gjennomsnittlig teamhelse: 0</p>
        `
          return
        }

        // Hent faktisk gjeldende ukenummer basert pÃ¥ dagens dato (ikke fra input-feltet)
        const currentDate = new Date()
        const startDate = new Date(currentDate.getFullYear(), 0, 1)
        const days = Math.floor(
          (currentDate - startDate) / (24 * 60 * 60 * 1000)
        )
        const currentWeekNumber = Math.ceil((days + startDate.getDay() + 1) / 7)

        // Filtrer data for gjeldende uke
        const currentWeekData = appData.temperatureData.filter(
          (entry) => parseInt(entry.week) === currentWeekNumber
        )
        const responseCount = currentWeekData.length

        // Beregn gjennomsnittlig teamhelse for gjeldende uke
        const avgHealth =
          responseCount > 0 ? calculateAverageHealth(currentWeekData) : '0'

        // Vis statistikken
        currentWeekStats.innerHTML = `
        <p>Antall svar: ${responseCount}</p>
        <p>Gjennomsnittlig teamhelse: ${avgHealth}</p>
        <p>Ukenummer: ${currentWeekNumber}</p>
      `

        // Vis informasjon hvis det er fÃ¥ eller ingen svar
        if (responseCount === 0) {
          currentWeekStats.innerHTML += `<p style="color: orange;">Ingen mÃ¥linger registrert for uke ${currentWeekNumber}.</p>`
        } else if (responseCount < appData.teamSize * 0.5) {
          currentWeekStats.innerHTML += `<p style="color: orange;">Lav svarprosent: ${Math.round((responseCount / appData.teamSize) * 100)}%</p>`
        }
      }

      // Oppdaterer kategoristastistikk
      function updateCategoryStats() {
        if (!appData.temperatureData) return

        const categories = [
          { key: 'feeling', label: 'Trivsel' },
          { key: 'motivation', label: 'Motivasjon' },
          { key: 'workload', label: 'Arbeidsmengde' },
          { key: 'stress', label: 'Stress' },
          { key: 'clarity', label: 'Klarhet' },
          { key: 'expectations', label: 'Forventninger' },
          { key: 'collaboration', label: 'Samarbeid' },
          { key: 'communication', label: 'Kommunikasjon' },
          { key: 'feedback', label: 'Tilbakemelding' },
          { key: 'recognition', label: 'Anerkjennelse' },
        ]

        categoryStats.innerHTML = categories
          .map((category) => {
            const average = calculateAverageCategory(
              appData.temperatureData,
              category.key
            )
            return `
          <div class="stat-card">
            <div class="stat-title">${category.label}</div>
            <div>${average}</div>
          </div>
        `
          })
          .join('')
      }

      // Calculate average score for a category
      function calculateAverageCategory(data, category) {
        if (!data || data.length === 0) return 0
        const total = data.reduce(
          (sum, entry) => sum + parseInt(entry[category]),
          0
        )
        return (total / data.length).toFixed(2)
      }

      // Initialize charts
      function initCharts() {
        const ctxTrend = document.getElementById('trend-chart')

        // Sjekk om elementene finnes fÃ¸r vi prÃ¸ver Ã¥ bruke dem
        if (!ctxTrend) {
          console.log(
            'Chart-elementer ikke funnet - hopper over initialisering'
          )
          return // Avslutt funksjonen hvis elementene ikke finnes
        }

        trendChart = new Chart(ctxTrend.getContext('2d'), {
          type: 'line',
          data: {
            labels: [],
            datasets: [
              {
                label: 'Gjennomsnittlig teamhelse',
                data: [],
                borderColor: '#3498db',
                backgroundColor: 'rgba(52, 152, 219, 0.2)',
                fill: true,
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: true },
              tooltip: { enabled: true },
            },
            scales: {
              x: { title: { display: true, text: 'Uke' } },
              y: {
                title: { display: true, text: 'Gjennomsnittlig score' },
                min: 0,
                max: 5,
              },
            },
          },
        })
      }

      // Update charts
      function updateCharts() {
        if (!appData.temperatureData || appData.temperatureData.length === 0)
          return

        // Sjekk om chart-elementene eksisterer
        const trendChartElement = document.getElementById('trend-chart')
        if (!trendChartElement) {
          console.log(
            'Chart-elementer ikke funnet i updateCharts - hopper over oppdatering'
          )
          return // Avslutt funksjonen hvis elementene ikke finnes
        }

        // Beregn gjennomsnittlig teamhelse per uke
        const weeklyStats = {}
        appData.temperatureData.forEach((entry) => {
          if (!weeklyStats[entry.week]) {
            weeklyStats[entry.week] = { total: 0, count: 0 }
          }
          const average =
            (parseInt(entry.feeling) +
              parseInt(entry.motivation) +
              parseInt(entry.workload) +
              parseInt(entry.stress) +
              parseInt(entry.clarity) +
              parseInt(entry.expectations) +
              parseInt(entry.collaboration) +
              parseInt(entry.communication) +
              parseInt(entry.feedback) +
              parseInt(entry.recognition)) /
            10
          weeklyStats[entry.week].total += average
          weeklyStats[entry.week].count++
        })

        const weeks = Object.keys(weeklyStats).sort((a, b) => a - b)
        const averages = weeks.map((week) =>
          (weeklyStats[week].total / weeklyStats[week].count).toFixed(2)
        )

        // Beregn bayesiansk justert indeks for hver uke
        const bayesianIndices = weeks.map((week) => {
          const rawScore = weeklyStats[week].total / weeklyStats[week].count
          const responseCount = weeklyStats[week].count
          return calculateBayesianAdjustedIndex(
            rawScore,
            responseCount,
            appData.teamSize
          ).toFixed(2)
        })

        // Oppdater linjegraf
        if (trendChart) trendChart.destroy()
        const ctx = document.getElementById('trend-chart').getContext('2d')
        trendChart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: weeks,
            datasets: [
              {
                label: 'Gjennomsnittlig teamhelse',
                data: averages,
                borderColor: '#3498db',
                backgroundColor: 'rgba(52, 152, 219, 0.2)',
                fill: true,
              },
              {
                label: 'Bayesiansk justert indeks',
                data: bayesianIndices,
                borderColor: '#f39c12',
                backgroundColor: 'rgba(243, 156, 18, 0.2)',
                fill: false,
                borderWidth: 2,
                pointBackgroundColor: '#f39c12',
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: true },
              tooltip: { enabled: true },
            },
            scales: {
              x: { title: { display: true, text: 'Uke' } },
              y: {
                title: { display: true, text: 'Gjennomsnittlig score' },
                min: 0,
                max: 5,
              },
            },
          },
        })

        // Kall resizeCharts for Ã¥ justere dimensjonene
        resizeCharts()
      }

      // Resize diagrammene
      function resizeCharts() {
        const trendChart = document.getElementById('trend-chart')

        // Sjekk om elementene finnes
        if (!trendChart) return

        const trendChartContainer = trendChart.parentElement
        // Sett hÃ¸yde basert pÃ¥ bredden av containeren
        trendChartContainer.style.height = `${trendChartContainer.offsetWidth * 0.6}px`
      }

      // Kalles nÃ¥r vinduet endrer stÃ¸rrelse
      window.addEventListener('resize', resizeCharts)

      // Beregn Bayesiansk justert indeks
      function calculateBayesianAdjustedIndex(
        rawScore,
        responseCount,
        teamSize
      ) {
        const k = 3
        const defaultValue = 3.0
        const responseRate = responseCount / teamSize // Tar hensyn til teamstÃ¸rrelse

        // Juster k-verdien basert pÃ¥ svarprosent
        const adjustedK = k * (1 - responseRate) + 1

        return (
          (responseCount * rawScore + adjustedK * defaultValue) /
          (responseCount + adjustedK)
        )
      }

      // Beregn bevegelig gjennomsnitt
      function calculateMovingAverage(
        currentIndex,
        previousIndex,
        twoWeeksAgoIndex
      ) {
        if (!previousIndex) return currentIndex
        if (!twoWeeksAgoIndex) return 0.6 * currentIndex + 0.4 * previousIndex
        return 0.6 * currentIndex + 0.3 * previousIndex + 0.1 * twoWeeksAgoIndex
      }

      // Initialize the app on page load
      window.onload = function () {
        // Last inn dataene direkte
        mainContent.style.display = 'block'

        // Initialiser appen
        initApp()
      }
    </script>
  </body>
</html>
